<?xml version="1.0" encoding="UTF-8"?>

<!-- Mapper 설정 파일임을 선언하는 부분 -->
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.kh.tour.member.model.mapper.MemberMapper">
	<sql id="selectMemberSql">
		SELECT
				UNO,
				U_NAME,
				U_EMAIL,
				U_PASSWORD,
				U_PHONE,
				U_ADDRESS,
				U_AVATAR,
				U_STATUS,
				MANAGER_STATUS,
		FROM MEMBER
	</sql>
	
	<resultMap type="Member" id="memberResultMap">
		<id property="uNo" column="UNO"/>
		<result property="uName" column="U_NAME"/>
		<result property="uEmail" column="U_EMAIL"/>
		<result property="uPassword" column="U_PASSWORD"/>
		<result property="uPhone" column="U_PHONE"/>
		<result property="uAddress" column="U_ADDRESS"/>
		<result property="uAvatar" column="U_AVATAR"/>
		<result property="uStatus" column="U_STATUS"/>
		<result property="managerStatus" column="MANAGER_STATUS"/>
	</resultMap>
	
	<select id="selectCount" resultType="int">
		SELECT COUNT(*) FROM MEMBER
	</select>
	
	<select id="selectAll" resultMap="memberResultMap">
		<include refid="selectMemberSql"/>
	</select>
	
	<!-- 
 		외부에서 매개변수로 받는 값이 있으면 해당하는 매개변수의 타입을 지정해줘야한다.(parameterType="string")
 		외부에서 매개변수로 받은 값은 #{변수명}로 설정해서 값을 가져온다.
 	 -->
	<select id="selectMember" parameterType="string" resultMap="memberResultMap">
		<include refid="selectMemberSql"/>
		WHERE ID = #{uEmail} AND STATUS = 'Y'
	</select>
	
	<insert id="insertMember" parameterType="Member"
		useGeneratedKeys="true" keyColumn="UNO" keyProperty="uNo">
		INSERT INTO MEMBER (
		    UNO, U_NAME, U_EMAIL, 
		    U_PASSWORD, U_PHONE, U_ADDRESS, 
		    U_AVATAR, U_STATUS, MANAGER_STATUS, 
		) VALUES (
		    SEQ_UNO.NEXTVAL, #{uName}, #{uEmail}, 
		    #{uPassword}, #{uPhone}, 
		    #{uAddress}, #{uAvatar}, DEFAULT, DEFAULT
		)
	</insert>
	
	<update id="updateMember" parameterType="Member">
		UPDATE MEMBER
		SET
			U_NAME 	= #{uName},
			U_EMAIL 	= #{uEmail},
			U_PHONE 	= #{uPhone},
			U_ADDRESS = #{uAddress},
			U_AVATAR 	= #{uAvatar},
		WHERE UNO = #{uNo}
	</update>
	
	<update id="updatePwd" parameterType="map">
		UPDATE MEMBER SET U_PASSWORD = #{newPwd} WHERE UNO = #{uNo}
	</update>
	
	<update id="deleteMember" parameterType="int">
		UPDATE MEMBER
			SET U_STATUS = 'N'
		WHERE UNO = #{uNo}
	</update>

</mapper>